From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Patrick Meyer <git@the-space.agency>
Date: Thu, 28 Apr 2022 01:50:11 +0000
Subject: [PATCH] Remove some unsupported socket operations

Co-Authored-By: Yonatan Goldschmidt <yon.goldschmidt@gmail.com>
---
 netio.c | 6 +-----
 1 file changed, 1 insertion(+), 5 deletions(-)

diff --git a/netio.c b/netio.c
index b8aebead81a9ea841c2e96864b0b4b08deafedde..224f37e826885aeee76e09471d48699ca8b0ce8c 100644
--- a/netio.c
+++ b/netio.c
@@ -305,7 +305,7 @@ void packet_queue_to_iovec(const struct Queue *queue, struct iovec *iov, unsigne
 	buffer *writebuf;
 
 #ifndef IOV_MAX
-	#if defined(__CYGWIN__) && !defined(UIO_MAXIOV)
+	#if !defined(UIO_MAXIOV)
 		#define IOV_MAX 1024
 	#elif defined(__sgi)
 		#define IOV_MAX 512 
@@ -472,7 +472,6 @@ int dropbear_listen(const char* address, const char* port,
 	struct addrinfo hints, *res = NULL, *res0 = NULL;
 	int err;
 	unsigned int nsock;
-	struct linger linger;
 	int val;
 	int sock;
 	uint16_t *allocated_lport_p = NULL;
@@ -551,9 +550,6 @@ int dropbear_listen(const char* address, const char* port,
 		val = 1;
 		/* set to reuse, quick timeout */
 		setsockopt(sock, SOL_SOCKET, SO_REUSEADDR, (void*) &val, sizeof(val));
-		linger.l_onoff = 1;
-		linger.l_linger = 5;
-		setsockopt(sock, SOL_SOCKET, SO_LINGER, (void*)&linger, sizeof(linger));
 
 #if defined(IPPROTO_IPV6) && defined(IPV6_V6ONLY)
 		if (res->ai_family == AF_INET6) {
