From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Patrick Meyer <git@the-space.agency>
Date: Thu, 28 Apr 2022 01:50:11 +0000
Subject: [PATCH] Disable SSP

Co-Authored-By: Yonatan Goldschmidt <yon.goldschmidt@gmail.com>
---
 configure    | 51 ---------------------------------------------------
 configure.ac | 16 ----------------
 2 files changed, 67 deletions(-)

diff --git a/configure b/configure
index e1986dda9ca83723c78c9bfec3daad49ee1a717d..1fd45b0a0a82a0187924201e7c4a6a46acd6405f 100755
--- a/configure
+++ b/configure
@@ -4242,57 +4242,6 @@ fi
 rm -f core conftest.err conftest.$ac_objext conftest.beam \
     conftest$ac_exeext conftest.$ac_ext
 	fi # non-static
-	# stack protector. -strong is good but only in gcc 4.9 or later
-	OLDCFLAGS="$CFLAGS"
-	TESTFLAGS="-fstack-protector-strong"
-	CFLAGS="$TESTFLAGS $CFLAGS"
-	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main (void)
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"
-then :
-  { printf "%s\n" "$as_me:${as_lineno-$LINENO}: Setting $TESTFLAGS" >&5
-printf "%s\n" "$as_me: Setting $TESTFLAGS" >&6;}
-else $as_nop
-
-			CFLAGS="$OLDCFLAGS"
-			TESTFLAGS="-fstack-protector --param=ssp-buffer-size=4"
-			CFLAGS="$TESTFLAGS $CFLAGS"
-			cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main (void)
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"
-then :
-  { printf "%s\n" "$as_me:${as_lineno-$LINENO}: Setting $TESTFLAGS" >&5
-printf "%s\n" "$as_me: Setting $TESTFLAGS" >&6;}
-else $as_nop
-  { printf "%s\n" "$as_me:${as_lineno-$LINENO}: Not setting $TESTFLAGS" >&5
-printf "%s\n" "$as_me: Not setting $TESTFLAGS" >&6;}; CFLAGS="$OLDCFLAGS"
-
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.beam \
-    conftest$ac_exeext conftest.$ac_ext
-
-
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.beam \
-    conftest$ac_exeext conftest.$ac_ext
 	# FORTIFY_SOURCE
 	{
 		OLDFLAGS="$CFLAGS"
diff --git a/configure.ac b/configure.ac
index a4f8f94b69e869f00f1631d29a3fe4238332ade2..bc3ab6d6a19cc995d07a7f187f092ccd5cc72e59 100644
--- a/configure.ac
+++ b/configure.ac
@@ -116,22 +116,6 @@ if test "$hardenbuild" -eq 1; then
 			[AC_MSG_NOTICE([Not setting $TESTFLAGS]); LDFLAGS="$OLDLDFLAGS" ]
 			)
 	fi # non-static
-	# stack protector. -strong is good but only in gcc 4.9 or later
-	OLDCFLAGS="$CFLAGS"
-	TESTFLAGS="-fstack-protector-strong"
-	CFLAGS="$TESTFLAGS $CFLAGS"
-	AC_LINK_IFELSE([AC_LANG_PROGRAM([])],
-	    [AC_MSG_NOTICE([Setting $TESTFLAGS])],
-	    [
-			CFLAGS="$OLDCFLAGS"
-			TESTFLAGS="-fstack-protector --param=ssp-buffer-size=4"
-			CFLAGS="$TESTFLAGS $CFLAGS"
-			AC_LINK_IFELSE([AC_LANG_PROGRAM([])],
-			    [AC_MSG_NOTICE([Setting $TESTFLAGS])],
-			    [AC_MSG_NOTICE([Not setting $TESTFLAGS]); CFLAGS="$OLDCFLAGS" ]
-			    )
-	    ]
-	    )
 	# FORTIFY_SOURCE
 	DB_TRYADDCFLAGS([-D_FORTIFY_SOURCE=2])
 
